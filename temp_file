\\There are rooms. each room has a type(bedroom, kitchen and so on) Some rooms have a light bulb, some have have a tap.function room(id, type, hasLightBulb, hasTap) {
    return ctx.Entity(id, 'room', {type: type, hasLightBulb: hasLightBulb, hasTap: hasTap})
}

\\Needed queries:
  1. room
  2. room with tap
  3. kitchenctx.registerQuery('room', entity => entity.type == 'room');

ctx.registerQuery('roomWithTap', entity => entity.type == 'room' && entity.hasTap);

ctx.registerQuery('kitchen', entity => entity.type == 'room' && entity.type == 'kitchen');

\\For each room with a tap, when the tap's button is pressed, pour hot water three times.function tapButtonPressedEvent(roomId) {
    return Event("tapButtonPressedEvent", {roomId: roomId});
}

function pourHotWaterEvent(roomId) {
    return Event("pourHotWaterEvent", {roomId: roomId});
}

ctx.bthread('Pour hot water three times when tap button is pressed', 'roomWithTap', function (room) {
    while (true) {
        sync({waitFor: [tapButtonPressedEvent(room.id)]});
        for (let i = 0; i < 3; i++) {
            sync({request: [pourHotWaterEvent(room.id)]});
        }
    }
});

\\For each room with a tap, when the tap's button is pressed, pour cold water three times.function pourColdWaterEvent(roomId) {
    return Event("pourColdWaterEvent", {roomId: roomId});
}

ctx.bthread('Pour cold water three times when tap button is pressed', 'roomWithTap', function (room) {
    while (true) {
        sync({waitFor: [tapButtonPressedEvent(room.id)]});
        for (let i = 0; i < 3; i++) {
            sync({request: [pourColdWaterEvent(room.id)]});
        }
    }
});

